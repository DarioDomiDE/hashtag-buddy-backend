<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Instaq</title>
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<meta name="apple-mobile-web-app-capable" content="yes"/>
	
	<style>
		* {
			margin: 0;
			padding: 0;
		}
		body {
			overflow-x: hidden;
		}
		h1 {
			margin: 50px 0 0 0;
			font-size: 1.8em;
		}
		h2 {
			font-size: 1.5em;
		}
		#main,
		#resultBox {
			margin: 30px auto;
			padding: 0;
			max-width: 80%;
		}
		#results ul {
			list-style: none;
		}
		.hidden {
			display: none;
		}
		input[type=file] {
			padding: 0;
		}
		#submitBtn {
			margin-top: 10px;
		}
		p {
			margin-bottom: 0.3rem;
		}
		ul {
			list-style: none;
		}
		ul li {
			display: inline-block;
			padding: 1px 6px;
			border: 1px solid #c4c4c4;
			margin: 0 5px 5px 0;
			border-radius: 3px;
		}
	</style>
</head>

<body>
<div class="row">
    <div class="col-md-12" style="text-align: center;">
        <h1>Find the most relevant Instagram Hashtags</h1>
		<p id="version"></p>
    </div>
</div>


<div class="row">
    <div id="main" class="col-md-6">
        <form id="formFile" class="form-horizontal" method="post" action="#" enctype="multipart/form-data" style="border-radius: 25px; padding: 20px; border: 1px solid black; margin: 50px 0 100px 0;">
            <h2>Upload a photo</h2>
            <input class="btn btn-file form-control -file form-control" type="file" name="file" id="file" accept="image/*">
			<input id="submitBtn" class="btn btn-default" style="width: 100%" type="submit"/>
			<p id="loadingIndicator" class="hidden">Finding hashtags...</p>
        </form>
		<hr />
        <p>&copy; 2018 by InnoCliq</p>
    </div>
	
	<div id="resultBox" class="col-md-6 hidden">
        <div style="border-radius: 25px; padding: 25px; border: 1px solid black">
			<a href="/">< Back</a>
			<h2>Top Hashtags</h2>
			<div>
				<div id="results">
				</div>
			</div>
		</div>
	</div>
</div>

<script src="https://code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script>
	$(document).ready(function() {
	
		var success = function(data) {
			var content = '';
			$.each(data.mostRelevantHTags, function(index, val) {
				content += '<li>#' + val.name + '</li>';
			});
			content = '<ul>' + content + '</ul><hr />';
			$.each(data.trendingHTags, function(index, val) {
				content += '<li>#' + val.name + '</li>';
			});
			content = '<ul>' + content + '</ul>';
			$('#results').html(content);
			$('#main').addClass('hidden');
			$('#resultBox').removeClass('hidden');
		}
		var error = function(err) {
			alert('Error: ' + err.statusText);
			
			$('#submitBtn').removeClass('hidden');
			$('#loadingIndicator').addClass('hidden');
		}
		
		$('#formFile').on('submit', function(e) {
			e.preventDefault();
			
			var hasFile = $('#file').val() != '';
			
			var host = 'http://localhost:59892/image/file';
			
			if(hasFile) {
				var url = host;
				var data = new FormData();
				var file = $('#file')[0].files[0];
				data.append("file", file, file.name);
				
				var jqxhr = $.ajax({
					type: 'POST',
					url: url,
					cache: false,
					contentType: false,
					enctype: 'multipart/form-data',
					processData: false,
					data: data,
					success: success,
					error: error
				});
			}
			
			$('#submitBtn').addClass('hidden');
			$('#loadingIndicator').removeClass('hidden');
			
		});
		
		// version
		var url = 'http://instaq-api.innocliq.de/info/version';
		$.getJSON(url, function( data ) {
			$('#version').text(data.version + ' (' + data.date + ')');
		});
	});
</script>

</body>

</html>
